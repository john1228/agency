<script type="text/javascript">
    Highcharts.setOptions({
        colors: [
            '#b5edff', '#ffbab7', '#ED561B', '#DDDF00', '#24CBE5', '#64E572', '#FF9655', '#FFF263', '#6AF9C4'],
        xAxis: {
            labels: {
                style: {
                    color: '#ED561B',
                    font: "Microsoft Yahei"
                }
            },
            lineColor: '#ED561B'
        }
    });

    function showPage(tabId, url) {
        $('#myTab a[href="#' + tabId + '"]').tab('show'); // 显示点击的tab页面
        $('#' + tabId).html(' 页面加载中，请稍后...'); // 设置页面加载时的loading图片
        var sku = $('#sku').val();
        var year = $('#year').val();
        var month = $('#month').val();
        $('#' + tabId).load(url, {sku: sku, year: year, month: month});
    }
    ;

    $(function () {
        var coach = $('#coach').val();
        var sku = $('#sku').val();
        var year = $('#year').val();
        var month = $('#month').val();
        $('#order').load('report/order', {coach: coach, sku: sku, year: year, month: month});

        $('#coach,#sku,#year,#month').on('change', function () {
            var coach = $('#coach').val();
            var sku = $('#sku').val();
            var year = $('#year').val();
            var month = $('#month').val();
            var current_tab = window.location.href.split("#")[1];
            if (current_tab == 'order') {
                $('#order').load('report/order', {coach: coach, sku: sku, year: year, month: month});
            } else if (current_tab == 'appointment') {
                $('#appointment').load('report/appointment', {coach: coach, sku: sku, year: year, month: month});
            } else if ((current_tab == 'sale')) {
                $('#sale').load('report/sale', {coach: coach, sku: sku, year: year, month: month});
            } else {
                $('#order').load('report/order', {coach: coach, sku: sku, year: year, month: month});
            }
        });

    });
</script>

<div class="row">
  <div class="col-lg-12">
    <div class="clearfix">
      <ul id="myTab" class="nav nav-tabs pull-left">
        <li class="active"><a href="#order" onclick='showPage("order","report/order")'>订单统计</a></li>
        <li><a href="#appointment" onclick='showPage("appointment","report/appointment")'>预约统计</a></li>
        <li><a href="#sale" onclick='showPage("sale","report/sale")'>销售额统计</a></li>
      </ul>
      <div class="pull-right">
        <select class="form-control tpcleq pull-left" id="sku">
          <option value="">全部</option>
          <% @skus.each { |sku| %>
              <option value="<%= sku[0] %>"><%= sku[1] %></option>
          <% } %>
        </select>
        <select class="form-control tpcleq pull-left" id="coach">
          <option value="">全部</option>
          <% @coaches.each { |coach| %>
              <option value="<%= coach[0] %>"><%= coach[1] %></option>
          <% } %>
        </select>
        <select class="form-control tpcleq pull-left" id="year">
          <%
             (0..5).each { |index|
               year = Date.today.years_ago(index).year
          %>
              <option value="<%= year %>"><%= year %></option>
          <% } %>
        </select>


        <select class="form-control tpcleq pull-left" id="month">
          <%
             (1..12).each { |index|
               if index.eql?(Date.today.month)

          %>
                  <option value="<%= index %>" selected="selected"><%= index %>月</option>
              <% else %>
                  <option value="<%= index %>"><%= index %>月</option>
              <% end
                 } %>
        </select>
      </div>
    </div>
    <div class="panel-body">
      <div class="tab-content">
        <div class="tab-pane active" id="order"></div>
        <div class="tab-pane" id="appointment"></div>
        <div class="tab-pane" id="sale"></div>
      </div>
    </div>
  </div>
</div>
