<script type="text/javascript">
    Highcharts.setOptions({
        colors: [
            '#b5edff', '#ffbab7', '#ED561B', '#DDDF00', '#24CBE5', '#64E572', '#FF9655', '#FFF263', '#6AF9C4'],
        xAxis: {
            labels: {
                style: {
                    color: '#ED561B',
                    font: "Microsoft Yahei"
                }
            },
            lineColor: '#ED561B'
        }
    });
    $(function () {
        $('#sku,#year,#month').on('change', function () {
            var sku = $('#sku').val();
            var year = $('#year').val();
            var month = $('#month').val();
            $.getJSON('/report.json', {sku: sku, year: year, month: month}, function (data) {
                var _day = data.day;
                var _all = data.all;
                var _coach = data.coach;
                var orders = $('#orders').highcharts({
                    chart: {
                        type: 'areaspline'
                    },
                    title: {text: '订单统计'},
                    legend: {
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'top',
                        floating: true,
                        borderWidth: 1,
                        backgroundColor: '#FFFFFF'
                    },
                    xAxis: {
                        categories: _day
                    },
                    yAxis: {title: {text: '单数'}},
                    tooltip: {shared: true, valueSuffix: '单'},
                    credits: {enabled: false},
                    plotOptions: {areaspline: {fillOpacity: 0.5}},
                    series: [
                        {name: '总订单', data: _all},
                        {name: '私教订单', data: _coach}
                    ]
                });
            });
        });
        var orders = $('#orders').highcharts({
            chart: {
                type: 'areaspline'
            },
            title: {text: '订单统计'},
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'top',
                floating: true,
                borderWidth: 1,
                backgroundColor: '#FFFFFF'
            },
            xAxis: {
                categories: <%=@days%>
            },
            yAxis: {title: {text: '单数'}},
            tooltip: {shared: true, valueSuffix: '单'},
            credits: {enabled: false},
            plotOptions: {areaspline: {fillOpacity: 0.5}},
            series: [
                {name: '总订单', data: <%=@all%>},
                {name: '私教订单', data: <%=@coach%>}
            ]
        });
        var appointments = $('#appointments').highcharts({
            chart: {
                type: 'areaspline'
            },
            title: {text: '消课统计'},
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'top',
                floating: true,
                borderWidth: 1,
                backgroundColor: '#FFFFFF'
            },
            xAxis: {
                categories: <%=@days%>
            },
            yAxis: {title: {text: '单数'}},
            tooltip: {shared: true, valueSuffix: '节'},
            credits: {enabled: false},
            plotOptions: {areaspline: {fillOpacity: 0.5}},
            series: [
                {name: '消课数量', data: <%=@appointment%>}
            ]
        });
        var coaches = $('#coaches').highcharts({
            chart: {
                type: 'column'
            },
            title: {text: '销售额统计'},
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'top',
                floating: true,
                borderWidth: 1,
                backgroundColor: '#FFFFFF'
            },
            xAxis: {
                categories: <%=@days%>
            },
            yAxis: {
                title: {text: '元'},
                stackLabels: {
                    enabled: true,
                    style: {fontWeight: 'bold', color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'}
                }
            },
            tooltip: {shared: true, valueSuffix: '元'},
            credits: {enabled: false},
            plotOptions: {
                column: {
                    stacking: 'normal'
                }
            },
            series: [
                {name: '总订单', data: <%=@all%>},
                {name: '私教订单', data: <%=@coach%>}
            ]
        });
    })
</script>

<ul id="myTab" class="nav nav-tabs">
  <li class="active">
    <a href="#order" data-toggle="tab">订单统计</a>
  </li>
  <li>
    <a href="#appointment" data-toggle="tab">预约统计</a>
  </li>
  <li>
    <a href="#coach" data-toggle="tab">销售额统计</a>
  </li>
</ul>
<div id="myTabContent" class="tab-content">
  <div class="tab-pane fade in active" id="order">
    <div class="row">
      <div class="col-lg-12">
        <div class="panel panel-default">
          <div class="panel-heading clearfix">
            <h3 class="panel-title  pull-left"></h3>

            <div class="pull-right pcoox">
              <select id="sku" name="sku">
                <% @skus.each { |sku| %>
                    <option value="<%= sku[0] %>"><%= sku[1] %></option>
                <% } %>
              </select>
              <select id="year" name="year">
                <%
                   (0..5).each { |index|
                     year = Date.today.years_ago(index).year
                %>
                    <option value="<%= year %>"><%= year %>年</option>
                <% } %>
              </select>
              <select id="month" name="month">
                <%
                   (1..12).each { |index|
                     if index.eql?(Date.today.month)

                %>
                        <option value="<%= index %>" selected="selected"><%= index %>月</option>
                    <% else %>
                        <option value="<%= index %>"><%= index %>月</option>
                    <% end
                       } %>
              </select>
            </div>
          </div>
          <div class="panel-body">
            <div id="orders"></div>
          </div>
        </div>
      </div>
      <div class="panel panel-default top15">
        <%= render 'order' %>
      </div>
      <div class="padding5">
        <%= will_paginate @orders, renderer: BootstrapPagination::Rails %>
      </div>
    </div>
  </div>
  <div class="tab-pane fade" id="appointment">
    <div class="row">
      <div class="col-lg-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"></h3>

            <div id="appointments"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="panel panel-default top15">
      <%= render 'appointment' %>
    </div>
    <div class=" padding5">
      <%= will_paginate @appointments, renderer: BootstrapPagination::Rails %>
    </div>
  </div>
  <div class="tab-pane fade" id="coach">
    <div class="row">
      <div class="col-lg-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title"></h3>

            <div id="coaches"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="panel panel-default top15">
      <%= render 'sale' %>
    </div>
  </div>
</div>